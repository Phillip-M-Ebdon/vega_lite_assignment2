{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "title": "Number of Colonies (approx), 2000",
  "config": {
    "background": "#161616",
    "text": {
      "color": "antiquewhite",
      "fill": "antiquewhite"
    },
    "axis": {
      "labelColor": "antiquewhite",
      "tickColor": "antiquewhite",
      "titleColor": "antiquewhite",
      "domainColor": "antiquewhite",
      "gridColor": "antiquewhite"
    },
    "legend": {
      "labelColor": "antiquewhite",
      "titleColor": "antiquewhite",
      "symbolFillColor": "antiquewhite"
    },
    "title": {
      "color": "antiquewhite"
    }
  },
  "data": {
    "url": "https://raw.githubusercontent.com/Phillip-M-Ebdon/vega_lite_homework_2/master/data/honey.csv"
  },
  "vconcat": [
    {
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Phillip-M-Ebdon/vega_lite_homework_2/master/data/us_10_topo.json",
            "format": {
              "type": "topojson",
              "feature": "states"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": "#363636",
            "stroke": "darkgray"
          }
        },
        {
          "width": 600,
          "height": 500,
          "transform": [
            {"calculate": "year(datum.Year)", "as": "Year"},
            {"filter": {"selection": "map_filt"}},
            {
              "lookup": "State",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/Phillip-M-Ebdon/vega_lite_homework_2/master/data/us_10_topo.json",
                  "format": {"type": "topojson", "feature": "states"}
                },
                "key": "properties.name",
                "fields": ["geometry", "properties.area"]
              },
              "as": ["geo", "sqmiles"]
            },
            {
              "calculate": "(datum.Honey_producing_colonies * 300) / datum.sqmiles",
              "as": "Colonies_per_Sq_Mile"
            }
          ],
          "projection": {"type": "albersUsa"},
          "mark": {"type": "geoshape"},
          "encoding": {
            "shape": {"field": "geo", "type": "geojson"},
            "color": {
              "condition": {
                "scale": {"scheme": "yelloworangered", "type":"threshold", "domain":[0, 0.01, 0.1, 0.5, 1, 1.5, 2]},
                "selection": "pts",
                "field": "Colonies_per_Sq_Mile",
                "type": "quantitative"
              },
              "value": "grey"
            },
            "tooltip": [{"field": "State"}, {"field": "Colonies_per_Sq_Mile"}]
          },
          "selection": {
            "pts": {"type": "single", "on": "click", "fields": ["State"]},
            "map_filt": {
              "init": {"Year": 2019},
              "type": "single",
              "fields": ["Year"],
              "bind": {
                "Year": {"input": "range", "min": 2000, "max": 2019, "step": 1}
              }
            }
          }
        }
      ]
    },
    {
      "width": 600,
      "mark":"circle",
      "transform": [
        {
          "lookup": "State",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Phillip-M-Ebdon/vega_lite_homework_2/master/data/us_10_topo.json",
              "format": {"type": "topojson", "feature": "states"}
            },
            "key": "properties.name",
            "fields": ["geometry", "properties.area"]
          },
          "as": ["geo", "sqmiles"]
        },
        {
          "calculate": "(datum.Honey_producing_colonies * 300) / datum.sqmiles",
          "as": "Colonies_per_Sq_Mile"
        },
        {"filter": {"selection": "pts"}}
      ],
      "encoding": {
        "color": {
          "field": "Colonies_per_Sq_Mile",
          "scale": {"scheme": "darkred", "type":"threshold", "domain":[0, 0.01, 0.1, 0.5, 1, 1.5, 2]},
          "title": "Colonies per Square Mile",
          "type": "quantitative"
        },
        "size": {
          "field": "Average_price_per_pound",
          "title": "Avg $US/lb",
          "type": "quantitative",
          "scale": {"type": "threshold", "domain": [0, 1, 3, 5, 8], "range": [1, 50, 100, 200, 500, 800]}
        },
        "x": {
          "field": "Year",
          "type": "temporal",
          "timeUnit": "year",
          "axis": {
            "tickMinStep": 1
          }
        },
        "y": {
          "field": "Yield_per_colony",
          "type": "quantitative"
        },
        "tooltip": [{"field": "State"}, {"field": "Colonies_per_Sq_Mile"}]
      }
    }
  ]
}