{
  "$schema": "https://vega.github.io/schema/vega-lite/v4.json",
  "title": "Number of Colonies (approx), 2000",
  "config": {
    "background": "#262626",
    "text": {
      "color": "antiquewhite",
      "fill": "antiquewhite"
    },
    "axis": {
      "labelColor": "antiquewhite",
      "tickColor": "antiquewhite",
      "titleColor": "antiquewhite",
      "domainColor": "antiquewhite",
      "gridColor": "antiquewhite"
    },
    "legend": {
      "labelColor": "antiquewhite"
    },
    "title": {
      "color": "antiquewhite"
    }
  },
  "data": {
    "url": "https://raw.githubusercontent.com/Phillip-M-Ebdon/vega_lite_homework_2/master/data/honey.csv"
  },
  "vconcat": [
    {
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Phillip-M-Ebdon/vega_lite_homework_2/master/data/us_10_topo.json",
            "format": {
              "type": "topojson",
              "feature": "states"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": "lightgray",
            "stroke": "white"
          }
        },
        {
          "width": 600,
          "height": 500,
          "transform": [
            {"calculate": "year(datum.Year)", "as": "Year"},
            {"filter": {"selection": "map_filt"}},
            {
              "lookup": "State",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/Phillip-M-Ebdon/vega_lite_homework_2/master/data/us_10_topo.json",
                  "format": {"type": "topojson", "feature": "states"}
                },
                "key": "properties.name",
                "fields": ["geometry", "properties.area"]
              },
              "as": ["geo", "sqmiles"]
            },
            {
              "calculate": "(datum.Honey_producing_colonies * 300) / datum.sqmiles",
              "as": "Colonies_per_Sq_Mile"
            }
          ],
          "projection": {"type": "albersUsa"},
          "mark": {"type": "geoshape"},
          "encoding": {
            "shape": {"field": "geo", "type": "geojson"},
            "color": {
              "condition": {
                "scale": {"scheme": "oranges"},
                "selection": "pts",
                "field": "Colonies_per_Sq_Mile",
                "type": "quantitative"
              },
              "value": "grey"
            },
            "tooltip": [{"field": "State"}, {"field": "Colonies_per_Sq_Mile"}]
          },
          "selection": {
            "pts": {"type": "single", "on": "click", "fields": ["State"]},
            "map_filt": {
              "init": {"Year": 2019},
              "type": "single",
              "fields": ["Year"],
              "bind": {
                "Year": {"input": "range", "min": 2000, "max": 2019, "step": 1}
              }
            }
          }
        }
      ]
    },
    {
      "mark":"circle",
      "transform": [
        {
          "lookup": "State",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/Phillip-M-Ebdon/vega_lite_homework_2/master/data/us_10_topo.json",
              "format": {"type": "topojson", "feature": "states"}
            },
            "key": "properties.name",
            "fields": ["geometry", "properties.area"]
          },
          "as": ["geo", "sqmiles"]
        },
        {
          "calculate": "(datum.Honey_producing_colonies * 300) / datum.sqmiles",
          "as": "Colonies_per_Sq_Mile"
        }
      ],
      "encoding": {
        "color": {
          "field": "Colonies_per_Sq_Mile",
          "type": "quantitative"
        },
        "size": {
          "field": "Average_price_per_pound",
          "type": "quantitative"
        },
        "x": {
          "field": "Year"
        },
        "y": {
          "field": "Yield_per_colony",
          "type": "quantitative"
        }
      }
    }
  ]
}